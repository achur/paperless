{include file="header.html"}

<script type="text/javascript" src="{$root_url}static/js/jquery-1.4.1.min.js"></script>
<script type="text/javascript" src="{$root_url}static/js/jquery-1.4.2.js"></script>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/jquery-ui.min.js"></script> 
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css"> 

<script type="text/javascript" src="{$root_url}static/js/feedback.js"></script>
<script type="text/javascript" src="{$root_url}static/js/shortcut.js"></script>

<script type="text/javascript" src="{$root_url}static/js/Comment.js"></script>
<script type="text/javascript" src="{$root_url}static/js/LineRange.js"></script>
<script type="text/javascript" src="{$root_url}static/js/CodeFile.js"></script>

<script type="text/javascript" src="{$root_url}static/js/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="{$root_url}static/js/syntaxhighlighter/scripts/shBrushCpp.js"></script>
<link type="text/css" rel="stylesheet" href="{$root_url}static/js/syntaxhighlighter/styles/shCoreDefault.css" id="syntaxStylesheet" />
<script type="text/javascript">SyntaxHighlighter.all();</script>

<h2>
{if $is_section_leader}
<span class="link"><a href="{$root_url}{$class}/assignment/{$sl}/{$assignment}">{$assignment}</a></span>
{else}
{$assignment}
{/if}

by 
<span class="link"><a href="{$root_url}{$class}/student/{$student}">{$student}</a></span> 
</h2>

<script type="text/javascript">

    var files = new Array();
    {foreach from=$files item=file key=i}
    files[{$i}] = '{$file}';
    {/foreach}
    
    // we need to wait for the syntax highlighter to finish before we access the modified dom
    $(document).ready(function(){
       setTimeout("setupCodeFiles()", 1000); 
    });
    
    function setupCodeFiles(){
        
        {foreach from=$files item=file key=i}
        var cur_file = new CodeFile('{$file}', {$i});
        
        {foreach from=$assignment_files[$i]->getAssignmentComments() item=comment}
            for(var i = {$comment->getStartLine()}; i < {$comment->getEndLine()}; i++)
                cur_file.hiliteLineNo(i);
                
            var curRange = new LineRange({$comment->getStartLine()}, {$comment->getEndLine()});
            var curComment = new Comment('{$comment->getCommentText()}', curRange, cur_file);
            cur_file.addComment(curComment);
        {/foreach}
        
    	code_files.push(cur_file);
    	{/foreach}
    }
    
    function hideall(){
    	 for(var i = 0; i < files.length; i++){	 
    		 document.getElementById("file" + i).className = "hidden";
    		 document.getElementById("comments" + i).className = "hidden";
    	 }
    }

    function display(fileNum){
		 current_file_id = fileNum; //so we know what is currently being viewed
    	 hideall();
    	 document.getElementById("file" + fileNum).className = "visible codeposition";	 
    	 document.getElementById("comments" + fileNum).className = "visible";
    }
    
    function edit(fileID, commentID){
    	var file = code_files[fileID];
    	var comment = file.getCommentFromID(commentID);
    	comment.edit();
    }
</script>

{foreach from=$files item=file key=i}
<div id="comments{$i}"></div>
{/foreach}

<div id="filelist">
    {foreach from=$files item=file key=i}
    <div class="link"><a href="javascript:display('{$i}')">{$file}</a></div>
    {/foreach}
</div>

{foreach from=$files item=file key=i}
<div id="file{$i}" class="hidden">
    <pre class="brush: cpp;">
{$file_contents[$i]}
    </pre>
</div>
{/foreach}

<script>
display(0);
</script>

<!-- <a href="http://alexgorbatchev.com/SyntaxHighlighter/">Syntax Highlighter Credit</a> -->


