{include file="header.html"}

<script type="text/javascript">SyntaxHighlighter.all();</script>


<div id="codeheader">
<h2>
{if $is_section_leader}
<span class="link"><a href="{$root_url}{$class}/assignment/{$sl}/{$assignment}">{$assignment}</a></span>
{else}
{$assignment}
{/if}

by 
<span class="link"><a href="{$root_url}{$class}/student/{$student}">{$student}</a></span> 
</h2>
</div>

<script type="text/javascript">
{if $interactive}
var interactive = true;
{else}
var interactive = false;
{/if}

    var files = new Array();
    {foreach from=$files item=file key=i}
    files[{$i}] = '{$file}';
    {/foreach}
    
    // we need to wait for the syntax highlighter to finish before we access the modified dom
    $(document).ready(function(){
       setTimeout("setupCodeFiles()", 1000); 
    });
    
    function setupCodeFiles(){
        
        {foreach from=$files item=file key=i}
		var cur_file = new CodeFile('{$file}', {$i}, interactive);
        
        {foreach from=$assignment_files[$i]->getAssignmentComments() item=comment}
		var curRange = new LineRange({$comment->getStartLine()}, {$comment->getEndLine()});
		cur_file.highlightRange(curRange);
		var curComment = new Comment('{$comment->getCommentText()}', curRange, cur_file);
		
		{if $interactive}
		var isEditable = true;
		{else}
		var isEditable = false;
		{/if}
		
		cur_file.addComment(curComment, isEditable);
        {/foreach}
        
		code_files.push(cur_file);
    	{/foreach}
        //console.log(code_files);
		display(0);
    }
    
    function hideall(){
    	 for(var i = 0; i < files.length; i++){	 
    		 document.getElementById("file" + i).className = "hidden";
    		 document.getElementById("comments" + i).className = "hidden";
 			$('#fileList'+i).removeClass('selectedFile');
    	 }
    }

    function display(fileNum){
		 current_file_id = fileNum; //so we know what is currently being viewed
    	 hideall();
    	 document.getElementById("file" + fileNum).className = "visible";	 
    	 document.getElementById("comments" + fileNum).className = "visible";
		 $('#fileList'+fileNum).addClass('selectedFile');
		 //console.log(code_files[fileNum]);
		if(!code_files[fileNum].displayed)
		   code_files[fileNum].showComments();
    }
    
    function edit(fileID, commentID){
    	var file = code_files[fileID];
    	var comment = file.getCommentFromID(commentID);
    	comment.edit();
    }
</script>

{foreach from=$files item=file key=i}
<div id="comments{$i}"></div>
{/foreach}

<div id="filelist">
    {foreach from=$files item=file key=i}
    <div id="fileList{$i}" class="link"><a href="javascript:display('{$i}')">{$file}</a></div>
    {/foreach}
</div>

{foreach from=$files item=file key=i}
<div id="file{$i}" class="hidden">
    <pre class="brush: cpp;">
{$file_contents[$i]}
    </pre>
</div>
{/foreach}

<script>

</script>


<!-- <a href="http://alexgorbatchev.com/SyntaxHighlighter/">Syntax Highlighter Credit</a> -->